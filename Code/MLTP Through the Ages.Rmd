---
title: "<center>MLTP Data Visualization Through the Ages</center>"
author: "<center>Jay Shapiro</center>"
date: "<center>TBD</center>"
output: 
  html_document:
    theme: cerulean
  pdf_document: default 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

<br><br>

MLTP is the premiere level of competitive Tagpro in North America. Tagpro is a capture the flag game played between two teams of four players; each team typically has two offenders and two defenders in the competitive meta. This data visualization project will showcase some of the primary metrics used to evaluate players and how the stats have changed across modern competitive seasons.

The main statistics used to judge the individual performance of an offender are captures, grabs, scoring percentage, and hold. Captures is the number of times an offender scored, grabs is the number of times an offender picked up the flag, scoring percentage is simply (captures/grabs)*100, the percentage of grabs that result in a capture, and hold is the duration of time an offender has the flag in their possession. 

Defenders are mainly judged individually on prevent, tags, and kill/death ratio. Prevent is the duration of time the defender protected the flag from being grabbed, tags are the number of times a player kills a player on the other team, and kill/death ratio is (unsurprisingly) the number of tags divided by the number of deaths.

Finally, team success is typically measured in either win/loss/tie record or by score differential. I will use score differential for the purposes of this report, as a quantitative measure of success is more useful here than a qualitative one. 

<br><br>

##  Results

<br><br>

First, we examine several scatterplots.

```{r echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)
library(ggplot2)
library(ggfortify)
library(plotly)
library(data.table)
library(factoextra)
library(pls)
library(beeswarm)

MLTPfiles <- list.files(path = "C:/Users/jays/Desktop/Tagpro/MLTP_Stats/",
                        pattern = "*.tsv", full.names = TRUE)

MLTP_master_stats <- data.frame()

for (lambda in c(1:10)) {
  location <- MLTPfiles[lambda]
  temp <- fread(file = location, 
                sep = "\t", fill = TRUE, header = TRUE) %>% mutate(season = as.factor(lambda + 9))
  
  MLTP_master_stats <- rbind(MLTP_master_stats, temp)
}

#str(MLTP_master_stats)

MLTP_normalized_stats<- mutate(MLTP_master_stats, scpm = score/minutes, success_rate = pm/minutes, tpm = tags/minutes, 
                               poppm = pops/minutes, droppm = drops/minutes, gpm = grabs/minutes,
                               hpm = hold/minutes, cpm = captures/minutes, ppm = prevent/minutes, rpm = returns/minutes,
                               pupm = pups/minutes, kdr = tags/pops, limp = flaccids/minutes, LHpm = longholds/minutes, 
                               handpm = handoff/minutes, GHpm = goodhandoff/minutes, gorepm = goregrab/minutes, corepm = coregrab/minutes,
                               copm = cohandoff/minutes, inbasepm = retinbase/minutes, quickpm = quickret/minutes, savepm = saves/minutes,
                               HApm = holdagainst/minutes)

MLTP_filtered_stats <- MLTP_normalized_stats %>%
  filter(minutes >= 120) %>%
  select(-c(V28, team, pupscomp, score, minutes, pm, tags, pops, grabs, drops, hold, captures, prevent, returns,
            pups, pupscomp, flaccids, longholds, handoff, goodhandoff, goregrab, gohandoff, cohandoff, retinbase,
            quickret, saves, holdagainst, coregrab)) %>%
    mutate(position = ifelse(ppm > hpm, "Defense", "Offense"))

MLTP_defense_stats <- MLTP_filtered_stats %>%
  filter(ppm > hpm)

MLTP_offense_stats <- MLTP_filtered_stats %>%
  filter(hpm > ppm)

ppm_tpm_all <- MLTP_filtered_stats %>%
  plot_ly(
    x = ~ppm, 
    y = ~tpm, 
    size = ~success_rate, 
    color = ~position, 
    frame = ~season, 
    text = ~player, 
    hovertemplate = paste("<b>%{text}</b><br><br>",
                          "%{yaxis.title.text}: %{y}<br>",
                          "%{xaxis.title.text}: %{x}<br>",
                          "<extra></extra>"),
    type = 'scatter',
    mode = 'markers'
  ) %>%
    animation_opts(frame = 1500, easing = NULL, redraw = FALSE)

ppm_tpm_all
```

<br><br>



```{r echo = FALSE, warning = FALSE, message = FALSE}
ppm_tpm_d <- MLTP_defense_stats %>%
  plot_ly(
    x = ~ppm, 
    y = ~tpm, 
    size = ~success_rate, 
    color = ~position, 
    frame = ~season, 
    text = ~player, 
    hovertemplate = paste("<b>%{text}</b><br><br>",
                    "%{yaxis.title.text}: %{y}<br>",
                    "%{xaxis.title.text}: %{x}<br>",
                    "<extra></extra>"),
    type = 'scatter',
    mode = 'markers'
  ) %>%
  animation_opts(frame = 1500, easing = NULL, redraw = FALSE)

ppm_tpm_d
```

<br><br>

```{r echo = FALSE, warning = FALSE, message = FALSE}
hpm_cpm_all <- MLTP_filtered_stats %>%
  plot_ly(
    x = ~hpm, 
    y = ~cpm, 
    size = ~success_rate, 
    color = ~position, 
    frame = ~season, 
    text = ~player, 
    hovertemplate = paste("<b>%{text}</b><br><br>",
                    "%{yaxis.title.text}: %{y}<br>",
                    "%{xaxis.title.text}: %{x}<br>",
                    "<extra></extra>"),
    type = 'scatter',
    mode = 'markers'
  ) %>%
  animation_opts(frame = 1500, easing = NULL, redraw = FALSE)

hpm_cpm_all
```

<br><br>

```{r echo = FALSE, warning = FALSE, message = FALSE}
hpm_cpm_o <- MLTP_offense_stats %>%
  plot_ly(
    x = ~hpm, 
    y = ~cpm, 
    size = ~success_rate, 
    color = ~position, 
    frame = ~season, 
    text = ~player, 
    hovertemplate = paste("<b>%{text}</b><br><br>",
                    "%{yaxis.title.text}: %{y}<br>",
                    "%{xaxis.title.text}: %{x}<br>",
                    "<extra></extra>"),
    type = 'scatter',
    mode = 'markers'
  ) %>%
  animation_opts(frame = 1500, easing = NULL, redraw = FALSE)

hpm_cpm_o
```

<br><br>

```{r echo = FALSE, warning = FALSE, message = FALSE}
#Prevent by defenders
beeswarm(ppm ~ season, data = MLTP_defense_stats, pch = 16, col = rainbow(10), method = "hex",
         main = "Prevent Per Minute by MLTP Season", xlab = "Season", ylab = "Prevent Per Minute",
         )

#Plotly inbound
prevent <- plot_ly(data= MLTP_defense_stats, x = ~season, y = ~ppm, color = ~season, type = "box", boxpoints = 'all',
             text = ~player) %>%
  layout(scene = list(xaxis = list(title = 'Season'),
                      yaxis = list(title = 'Prevent Per Minute')),
         title = "Prevent Per Minute by MLTP Defenders")
prevent
```

<br><br>

```{r echo = FALSE, warning = FALSE, message = FALSE}
#Tags by defenders
beeswarm(tpm ~ season, data = MLTP_defense_stats, pch = 16, col = rainbow(10), method = "hex",
         main = "Tags Per Minute by MLTP Season", xlab = "Season", ylab = "Tags Per Minute",
         )

#Plotly inbound
tags <- plot_ly(data= MLTP_defense_stats, x = ~season, y = ~tpm, color = ~season, type = "box", boxpoints = 'all',
             text = ~player) %>%
  layout(scene = list(xaxis = list(title = 'Season'),
                      yaxis = list(title = 'Tags Per Minute')),
         title = "Tags Per Minute by MLTP Defenders")
tags
```

<br><br>

```{r echo = FALSE, warning = FALSE, message = FALSE}
#KDR by defenders
beeswarm(kdr ~ season, data = MLTP_defense_stats, pch = 16, col = rainbow(10), method = "hex",
         main = "Kill/Death Ratio by MLTP Season", xlab = "Season", ylab = "Kill/Death Ratio",
         )

#Plotly inbound
kdr <- plot_ly(data= MLTP_defense_stats, x = ~season, y = ~kdr, color = ~season, type = "box", boxpoints = 'all',
                text = ~player) %>%
  layout(scene = list(xaxis = list(title = 'Season'),
                      yaxis = list(title = 'Kill/Death Ratio')),
         title = "Kill/Death Ratio by MLTP Defenders")
kdr
```

<br><br>

```{r echo = FALSE, warning = FALSE, message = FALSE}
#Hold by attackers

beeswarm(hpm ~ season, data = MLTP_offense_stats, pch = 16, col = rainbow(10), method = "hex",
         main = "Hold Per Minute by MLTP Season", xlab = "Season", ylab = "Hold Per Minute",
         )

#Plotly inbound
hold <- plot_ly(data= MLTP_offense_stats, x = ~season, y = ~hpm, color = ~season, type = "box", boxpoints = 'all',
             text = ~player) %>%
  layout(scene = list(xaxis = list(title = 'Season'),
                      yaxis = list(title = 'Hold Per Minute')),
         title = "Hold Per Minute by MLTP Offenders")
hold
```

<br><br>

```{r echo = FALSE, warning = FALSE, message = FALSE}
#Caps for attackers
beeswarm(cpm ~ season, data = MLTP_offense_stats, pch = 16, col = rainbow(10), method = "hex",
         main = "Caps Per Minute by MLTP Season", xlab = "Season", ylab = "Captures Per Minute",
         )

caps <- plot_ly(data= MLTP_offense_stats, x = ~season, y = ~cpm, color = ~season, type = "box", boxpoints = 'all',
                text = ~player) %>%
  layout(scene = list(xaxis = list(title = 'Season'),
                      yaxis = list(title = 'Captures Per Minute')),
         title = "Captures Per Minute by MLTP Offenders")
caps
```

<br><br>

```{r echo = FALSE, warning = FALSE, message = FALSE}
#Grabs for attackers
beeswarm(gpm ~ season, data = MLTP_offense_stats, pch = 16, col = rainbow(10), method = "hex",
         main = "Grabs Per Minute by MLTP Season", xlab = "Season", ylab = "Grabs Per Minute",
         )

grabs <- plot_ly(data= MLTP_offense_stats, x = ~season, y = ~gpm, color = ~season, type = "box", boxpoints = 'all',
                text = ~player) %>%
  layout(scene = list(xaxis = list(title = 'Season'),
                      yaxis = list(title = 'Grabs Per Minute')),
         title = "Grabs Per Minute by MLTP Offenders")
grabs
```

```{r echo = FALSE}
sessionInfo()
```